## 2022년 5월 4일 수

### File I/O 확장
- - -
#### 원자성(atomic operation)과 경쟁 상태(race condition)
시스템 콜은 아토믹(atomic)하게 실행되는데, 호출 및 실행 과정에서 인터럽트 없이 동작이 완료된다. 이를 원자성이라 하며, 커널은 시스템 콜의 원자성을 보장한다.  
원자성이 보장되면 프로세스 자원을 동시에 접근하여, 스케쥴링 순서가 변동되어 비정상적인 결과가 발생하는 경쟁 상태를 피할 수 있다.

* open()의 원자성 요구  
  open(filepath, O_WRONLY)와 open(filepath, O_WRONY | O_CREAT, S_IRUSR | S_IWUSR)을 실행시키는 프로세스가 2개씩 존재할 때, 경쟁 상태가 발생하여 두 프로세스 모두 파일을 생성했다고 주장한다.  
  open()의 flag를 O_CREAT | O_EXCL로 설정하면, 파일의 존재 확인과 파일 생성이 아토믹하게 실행되어 원자성을 만족한다.
  
* 파일 출력에서의 원자성 요구  
  lseek(fd, 0, SEEK_END) 이후 write(fd, buf, len)를 호출하는 프로세스가 2개씩 존재한다면, 스케쥴링에 의해 두 프로세스 모두 파일 오프셋이 동일하게 설정되어 데이터를 덮어씌우는 현상이 발생한다.  
  해당 파일의 open() flag에 O_APPEND가 추가되면, 파일 오프셋을 끝으로 설정함과 파일 출력이 아토믹하게 실행되어 원자성을 만족한다.

#### 파일 제어 오퍼레이션: fcntl()
